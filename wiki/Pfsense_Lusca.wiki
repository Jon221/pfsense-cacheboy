#summary Install Lusca on pfsense.
= Introduction =
Compiled with:<br>
'--enable-removal-policies=lru heap' <br>
'--enable-storeio=aufs,coss,null' - _null if you don't want to use your hard drive_<br>
'--enable-delay-pools' <br>
'--enable-arp-acl' - _mac address acl_ <br>
'--enable-pf-transparent' <br>
'--enable-snmp' - _for MRTG_<br>

Lusca-cache patched r11. Patches applied:
  # ignore-must-revalidate
  # vary aware using storeurl
  # save vary object/index other than COSS (vary index will be lost on rebuild if in coss)
=== Instruction ===
  # From your "PfSense's GUI" run this at *Diagnostics* > *Command*. <br>_^other than lusca packages might be old. Use package off to use original repository.^_
{{{
fetch http://pfsense-cacheboy.googlecode.com/svn/trunk/script/package.sh && chmod +x package.sh && ./package.sh
}}}
  # Now you may install lusca-cache at *System* > *Packages*.
  # To restore or use original repository. <br>_^you can no longer see lusca updates^_
{{{
./package.sh off
}}}
*Notes*<br>
Configurations at:<br>
/usr/local/etc/squid/dir.conf - _customized cache_dir if you might need it most case if you have more than one coss, aufs_<br>
/usr/local/etc/squid/include.conf - _other squid configurations_<br>
/usr/local/etc/squid/refresh.conf - _refresh patterns_<br>

*Troubleshoot:*<br>
Pfsense GUI's doesn't save your configurations<br>
Causes:
  * Previous squid packages and scripts doesn't clean up properly(pfsense limitation).
  * config.xml is already dirty as well as your previous installation had already been compromised.
Fixed:<br>
Run this at *Diagnostics: Execute command* > *PHP execute*<br>
{{{
$num_fields = array('squidcache','squid','squidauth','squidnac','squidtraffic','squidupstream','squidusers');
foreach ($num_fields as $field)
unset($config['installedpackages']["$field"]);
write_config();
}}}
for selective approach where *squidcache* of URL _http://pfsense/pkg_edit.php?xml=squid_cache.xml&id=0_ as an example that usually doesn't save.<br>
{{{
unset($config['installedpackages'][squidcache]);
write_config();
}}}